<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Flappy Baby Reveal</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no, viewport-fit=cover" />
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    html, body {
      margin: 0;
      padding: 0;
      width: 100vw;
      height: 100vh;
      overflow: hidden;
      touch-action: none;
      overscroll-behavior: none;
      background: #bae6fd;
    }
    #gameCanvas {
      position: fixed;
      top: 0; left: 0;
      width: 100vw;
      height: 100vh;
      z-index: 0;
      display: block;
    }
  </style>
</head>
<body class="flex items-center justify-center min-h-screen bg-blue-100">
  <!-- Reveal overlay -->
  <div id="overlay"
       class="fixed inset-0 z-10 hidden flex items-center justify-center pointer-events-none">
    <div class="text-white text-5xl font-extrabold animate-bounce drop-shadow-lg">
      Ã‰ uma menina!
      <span class="text-pink-500">ðŸ‘¶</span>
    </div>
  </div>

  <!-- Game canvas -->
  <canvas id="gameCanvas"
        class="bg-sky-300 border-4 border-cyan-700 shadow-xl"></canvas>

  <script>
    const canvas = document.getElementById('gameCanvas');
    const ctx = canvas.getContext('2d');

    function resizeCanvas() {
      canvas.width = window.innerWidth;
      canvas.height = window.innerHeight;
    }
    resizeCanvas();
    window.addEventListener('resize', resizeCanvas);
    window.addEventListener('orientationchange', resizeCanvas);

    const bird = {
      x: 60,
      y: canvas.height / 2,
      r: 12,
      v: 0,
      g: 0.15, // Reduced gravity
      lift: -3 // Slightly stronger lift
    };

    let pipes = [];
    const pipeW = 60;
    const gap = 150; // Increased gap for easier play
    const speed = 1.5; // Slower pipes
    let frame = 0;
    let score = 0;
    let playing = true;
    let sparkles = [];
    let showSparkles = false;

    function reset() {
      bird.y = canvas.height / 2;
      bird.v = 0;
      pipes = [];
      frame = 0;
      score = 0;
      playing = true;
      document.getElementById('overlay').classList.add('hidden');
      requestAnimationFrame(loop);
    }

    function flap() {
      if (!playing) return; // Ignore input if not playing
      bird.v = bird.lift;
    }

    window.addEventListener('keydown', e => { if (e.code === 'Space') flap(); });
    canvas.addEventListener('click', flap);

    function drawBird() {
      ctx.beginPath();
      ctx.arc(bird.x, bird.y, bird.r, 0, Math.PI * 2);
      ctx.fillStyle = '#facc15';
      ctx.fill();
      ctx.lineWidth = 3;
      ctx.strokeStyle = '#d97706';
      ctx.stroke();
    }

    function drawPipes() {
      ctx.fillStyle = '#047857';
      pipes.forEach(p => {
        ctx.fillRect(p.x, 0, pipeW, p.top);
        ctx.fillRect(p.x, p.bottom, pipeW, canvas.height - p.bottom);
      });
    }

    function drawScore() {
      ctx.font = '32px monospace';
      ctx.fillStyle = '#0f172a';
      ctx.fillText(score, 10, 40);
    }

    function createSparkles(count = 60) {
      sparkles = [];
      for (let i = 0; i < count; i++) {
        sparkles.push({
          x: Math.random() * canvas.width,
          y: Math.random() * canvas.height,
          r: Math.random() * 4 + 2,
          dx: (Math.random() - 0.5) * 2,
          dy: (Math.random() - 1.5) * 3,
          alpha: 1 + Math.random() * 0.5,
          life: 0
        });
      }
      showSparkles = true;
    }

    function drawSparkles() {
      sparkles.forEach(s => {
        ctx.save();
        ctx.globalAlpha = Math.max(0, s.alpha);
        ctx.beginPath();
        ctx.arc(s.x, s.y, s.r, 0, Math.PI * 2);
        ctx.fillStyle = `hsl(${320 + Math.random()*20}, 90%, 80%)`;
        ctx.shadowColor = '#f472b6';
        ctx.shadowBlur = 12;
        ctx.fill();
        ctx.restore();
      });
    }

    function updateSparkles() {
      sparkles.forEach(s => {
        s.x += s.dx;
        s.y += s.dy;
        s.dy += 0.04;
        s.alpha -= 0.007;
        s.life++;
      });
      sparkles = sparkles.filter(s => s.alpha > 0 && s.life < 220);
      if (sparkles.length === 0) showSparkles = false;
    }

    function loop() {
      if (!playing) {
        if (showSparkles) {
          updateSparkles();
          drawSparkles();
          requestAnimationFrame(loop);
        }
        return;
      }

      ctx.clearRect(0, 0, canvas.width, canvas.height);

      // Physics
      bird.v += bird.g;
      bird.y += bird.v;

      // Spawn pipes
      if (frame % 150 === 0) {
        const top = Math.random() * (canvas.height - gap - 100) + 50;
        pipes.push({ x: canvas.width, top, bottom: top + gap, scored: false });
      }

      // Update pipes
      pipes.forEach(p => {
        p.x -= speed;

        // Collision
        if (
          bird.x + bird.r > p.x &&
          bird.x - bird.r < p.x + pipeW &&
          (bird.y - bird.r < p.top || bird.y + bird.r > p.bottom)
        ) playing = false;
        
        // Score
        if (!p.scored && p.x + pipeW < bird.x) {
          score++;
          p.scored = true;
          if (score > 2) {
            playing = false;
            document.getElementById('overlay').classList.remove('hidden');
            createSparkles();
            requestAnimationFrame(loop);
          }
        }
      });

      // Remove off-screen pipes
      pipes = pipes.filter(p => p.x + pipeW > 0);

      // Bounds
      if (bird.y + bird.r > canvas.height || bird.y - bird.r < 0) playing = false;

      drawPipes();
      drawBird();
      drawScore();

      if (showSparkles) {
        updateSparkles();
        drawSparkles();
      }

      frame++;
      requestAnimationFrame(loop);
    }

    // Prevent scrolling on mobile
    window.addEventListener('touchmove', function(e) { e.preventDefault(); }, { passive: false });

    loop();
  </script>
</body>
</html>